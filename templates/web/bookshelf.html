{% extends "base.html" %}

{% block title %}{{ t.bookshelf.title }} â€” {{ app_title }}{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <h4 class="mb-0">{{ t.bookshelf.title }}</h4>
    <div class="d-flex align-items-center gap-2">
      {# Sort controls #}
      <div class="btn-group btn-group-sm" role="group">
        <a href="/web/bookshelf?sort=date&dir={% if sort == 'date' and dir == 'desc' %}asc{% else %}desc{% endif %}"
           class="btn {% if sort == 'date' %}btn-secondary{% else %}btn-outline-secondary{% endif %}">
          {{ t.bookshelf.sort_date }}
          {% if sort == "date" %}<i class="bi bi-arrow-{% if dir == 'asc' %}up{% else %}down{% endif %} ms-1"></i>{% endif %}
        </a>
        <a href="/web/bookshelf?sort=title&dir={% if sort == 'title' and dir == 'asc' %}desc{% else %}asc{% endif %}"
           class="btn {% if sort == 'title' %}btn-secondary{% else %}btn-outline-secondary{% endif %}">
          {{ t.bookshelf.sort_title }}
          {% if sort == "title" %}<i class="bi bi-arrow-{% if dir == 'asc' %}up{% else %}down{% endif %} ms-1"></i>{% endif %}
        </a>
        <a href="/web/bookshelf?sort=author&dir={% if sort == 'author' and dir == 'asc' %}desc{% else %}asc{% endif %}"
           class="btn {% if sort == 'author' %}btn-secondary{% else %}btn-outline-secondary{% endif %}">
          {{ t.bookshelf.sort_author }}
          {% if sort == "author" %}<i class="bi bi-arrow-{% if dir == 'asc' %}up{% else %}down{% endif %} ms-1"></i>{% endif %}
        </a>
      </div>

      {# Clear all #}
      {% if books | length > 0 %}
      <form method="post" action="/web/bookshelf/clear" id="clear-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button type="button" class="btn btn-outline-danger btn-sm" onclick="if(confirm('{{ t.bookshelf.confirm_clear }}')) document.getElementById('clear-form').submit();">
          <i class="bi bi-trash me-1"></i>{{ t.bookshelf.clear_all }}
        </button>
      </form>
      {% endif %}
    </div>
  </div>

  {% if books | length == 0 %}
    <p class="text-body-secondary">{{ t.bookshelf.empty }}</p>
  {% else %}
    <div id="bookshelf-grid" class="row row-cols-1 row-cols-md-2 g-3"
         data-sort="{{ sort }}" data-dir="{{ dir }}"
         data-offset="{{ books | length }}" data-has-more="{{ has_more }}"
         data-batch="{{ batch_size }}">
      {% include "web/_bookshelf_cards.html" %}
    </div>

    <div id="bookshelf-loader" class="text-center py-4 d-none">
      <div class="spinner-border spinner-border-sm text-secondary" role="status"></div>
      <span class="ms-2 text-body-secondary small">{{ t.bookshelf.loading }}</span>
    </div>

    <div id="bookshelf-sentinel"></div>
  {% endif %}
{% endblock %}
